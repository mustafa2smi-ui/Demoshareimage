<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simple Image Gallery</title>

<style>
  body { font-family: Arial, sans-serif; margin:0; padding:20px; background:#f8f8f8; }
  .gallery { display:flex; flex-wrap:wrap; gap:15px; justify-content:center; }
  .card { background:white; padding:10px; border-radius:10px; width:280px; box-shadow:0 2px 6px #0002; }
  .card img { width:100%; border-radius:10px; cursor:pointer; }
  .card h3, .card p { margin:8px 0; text-align:center; }

  /* Floating Buttons */
  .btn-box{ position:fixed; bottom:30px; right:30px; display:flex; flex-direction:column; gap:10px; }
  .f-btn{
    background:#007bff; color:white; padding:12px 16px; border-radius:50px;
    border:none; cursor:pointer; font-size:16px; box-shadow:0 4px 10px #0004;
  }
</style>
</head>
<body>

<h2 style="text-align:center;">ðŸ“¸ My Image Gallery</h2>

<div class="gallery" id="gallery"></div>

<!-- Floating Buttons -->
<div class="btn-box">
  <button class="f-btn" onclick="downloadImg()">â¬‡ Download</button>
  <button class="f-btn" onclick="shareImg()">ðŸ”— Share</button>
</div>

<script>
/// ==== IMAGE DATA ====
const images = [
  {
    url: "https://raw.githubusercontent.com/mustafa2smi-ui/Demoshareimage/main/img1.jpg",
    title: "Beautiful Nature",
    desc: "Green mountains and fresh air"
  },
  {
    url: "https://raw.githubusercontent.com/mustafa2smi-ui/Demoshareimage/main/img2.jpg",
    title: "City Night",
    desc: "Light and energy of the city"
  },
  {
    url: "https://raw.githubusercontent.com/mustafa2smi-ui/Demoshareimage/main/img3.jpg",
    title: "Calm Beach",
    desc: "Relaxing waves and sunset"
  }
];
/// =====================

let selectedImg = null;

// Load Gallery
const gallery = document.getElementById("gallery");
images.forEach((img, i)=>{
  gallery.innerHTML += `
    <div class="card" onclick="selectImg(${i})">
      <img src="${img.url}" alt="${img.title}">
      <h3>${img.title}</h3>
      <p>${img.desc}</p>
    </div>
  `;
});

// Select Image
function selectImg(i){
  selectedImg = images[i];
  alert("Selected: " + selectedImg.title);
}

// Download Image
function downloadImg(){
  const img = selectedImg ?? images[Math.floor(Math.random()*images.length)];
  const link = document.createElement("a");
  link.href = img.url;
  link.download = img.title + ".jpg";
  link.click();
}
/*
// SHARE AS REAL FILE
async function shareImg(){
  const img = selectedImg ?? images[Math.floor(Math.random()*images.length)];

  try {
    const response = await fetch(img.url);
    const blob = await response.blob();

    const file = new File([blob], img.title + ".jpg", { type: "image/jpeg" });

    if (navigator.canShare && navigator.canShare({ files: [file] })) {
      await navigator.share({
        files: [file],
        title: img.title,
        text: img.desc
      });
    } else {
      alert("Sharing not supported on this browser!");
    }

  } catch (error) {
    alert("Sharing failed: " + error);
  }
}
  */
  /*
  // ==== SHARE FUNCTION (FINAL VERSION) ====
async function shareImg(){
  const img = selectedImg ?? images[Math.floor(Math.random()*images.length)];
  const response = await fetch(img.url);
  const blob = await response.blob();

  // ðŸ“Œ IMAGE RESIZE (SQUARE CROPPED IMAGE)
  const squareBlob = await cropToSquare(blob);

  const file = new File([squareBlob], img.title + ".jpg", { type: "image/jpeg" });

  // If device supports FILE SHARE
  if (navigator.canShare && navigator.canShare({ files: [file] })) {
    navigator.share({
      files: [file],
      title: img.title,
      text: img.desc + "\nCheck more: " + window.location.href
    });
  }
  // FALLBACK (Only URL & TEXT Share)
  else {
    const fallbackText = `${img.title} - ${img.desc}\nMore Photos: ${window.location.href}`;
    prompt("Copy & Share:", fallbackText);
  }
}

// ==== SQUARE CROPPING FUNCTION ====
async function cropToSquare(blob) {
  return new Promise((resolve) => {
    const imgElement = document.createElement("img");
    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");

    imgElement.onload = () => {
      const size = Math.min(imgElement.width, imgElement.height);
      canvas.width = canvas.height = size;
      ctx.drawImage(
        imgElement,
        (imgElement.width - size) / 2,  // X Cropping
        (imgElement.height - size) / 2, // Y Cropping
        size,
        size,
        0,
        0,
        size,
        size
      );
      canvas.toBlob(resolve, "image/jpeg");
    };

    imgElement.src = URL.createObjectURL(blob);
  });
}
  */
  // ==== FINAL SHARE FUNCTION (NO CROP / FULL IMAGE) ====
async function shareImg(){
  const img = selectedImg ?? images[Math.floor(Math.random()*images.length)];

  try {
    const response = await fetch(img.url);
    const blob = await response.blob();

    const file = new File([blob], img.title + ".jpg", { type: "image/jpeg" });

    // ðŸ“Œ FULL SHARE SUPPORT (IMAGE + TEXT + URL)
    if (navigator.canShare && navigator.canShare({ files: [file] })) {
      await navigator.share({
        files: [file],
        title: img.title,
        text: img.desc + "\nMore Photos: " + window.location.href
      });
    } 
    
    // ðŸ“Œ TEXT ONLY SHARE (fallback)
    else if (navigator.share) {   
      await navigator.share({
        title: img.title,
        text: img.desc + "\nMore Photos: " + window.location.href
      });
    }

    // ðŸ“Œ ULTIMATE FALLBACK (copy text box)
    else {
      const fallbackText = `${img.title} - ${img.desc}\nMore Photos: ${window.location.href}`;
      prompt("Copy & Share:", fallbackText);
    }
  } catch (error) {
    alert("Error while sharing: " + error);
  }
}
</script>
</body>
</html>
